var _isLeavingPage=!1;"object"==typeof window&&(window.onbeforeunload=function(){_isLeavingPage=!0}),function(e,n){"use strict";"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?module.exports=n():e.sendbird=n()}(this,function(){"use strict";function e(e,n,s,t){var a=new XMLHttpRequest;a.open("POST",e),a.setRequestHeader("Content-Type","text/plain; charset=UTF-8"),a.onload=function(){if(a.status>=i&&a.status<r){var e=a.responseText;s(JSON.parse(e))}else t(a.status,a.statusText)},a.send(JSON.stringify(n))}var n=!1,s=function(e){n&&console.log(e)},t=function(e){var n,s,t;for(e=e||{},n=arguments.length,s=1;n>s;s++)if(arguments[s])for(t in arguments[s])arguments[s].hasOwnProperty(t)&&(e[t]=arguments[s][t]);return e},i=200,r=400,a=function(){function a(e){return g+"v"+c.replace(/[^(0-9)]/gi,"")+"/"+e}function o(e){d.app_id=e.app_id,d.guest_id=e.guest_id,d.user_name=e.user_name,d.image_url=void 0==e.image_url||null==e.image_url?"":e.image_url,d.access_token=void 0==e.access_token||null==e.access_token?"":e.access_token,P({"successFunc":function(n){e.successFunc(n)},"errorFunc":function(n,s){e.errorFunc(n,s)},"async":e.async})}var c="1",u="wss://ws.jiver.co:9010",g="https://api.jiver.co/",l=null,p={"MESG":"MESG","FILE":"FILE","LOGI":"LOGI","JOIN":"JOIN","SYSM":"SYSM","BRDM":"BRDM","MCUP":"MCUP","READ":"READ","TPST":"TPST","TPEN":"TPEN","PING":"PING","PONG":"PONG"},d={},f={},_=0,m=0,v=null,F=null,y=null,h=0,S=!1,M=0,k=1e4,T=function(e,n){switch(e){case p.MESG:N.onMessageReceived(JSON.parse(n));break;case p.SYSM:N.onSystemMessageReceived(JSON.parse(n));break;case p.FILE:N.onFileMessageReceived(JSON.parse(n));break;case p.BRDM:N.onBroadcastMessageReceived(JSON.parse(n));break;case p.MCUP:N.onMessagingChannelUpdateReceived(JSON.parse(n));break;case p.TPST:N.onTypeStartReceived(JSON.parse(n));break;case p.TPEN:N.onTypeEndReceived(JSON.parse(n));break;case p.PONG:s(p.PONG);break;case p.READ:N.onReadReceived(JSON.parse(n));break;default:N.onUndefinedMessageReceived(e,JSON.parse(n))}return JSON.parse(n)},R={"successFunc":function(){},"errorFunc":function(e,n){console.log(e),console.log(n)}},N={"onMessageReceived":function(e){console.log(e)},"onSystemMessageReceived":function(e){console.log(e)},"onFileMessageReceived":function(e){console.log(e)},"onBroadcastMessageReceived":function(e){console.log(e)},"onReadReceived":function(e){console.log(e)},"onMessagingChannelUpdateReceived":function(e){console.log(e)},"onTypeStartReceived":function(e){console.log(e)},"onTypeEndReceived":function(e){console.log(e)},"onMessageDelivery":function(e){console.log(e)},"onUndefinedMessageReceived":function(e,n){s(e),s(n)}},O=6,P=function(n){var r,o,c;s("=== Start SendBird SDK ==="),r=t({},R,n),o="guest_login/",c={"guest_id":d.guest_id,"app_id":d.app_id,"nickname":d.user_name,"image_url":d.image_url,"access_token":d.access_token},e(a(o),c,function(e){e.error?r.errorFunc(i,e.message):(d.guest_key=e.key,r.successFunc({}))},function(e,n){r.errorFunc(e,n)})},b=function(n,r){var o,c,u,g;s("=== Join Channel ==="),o=t({},R,r),c="channel_join/",u={"app_id":d.app_id,"session_key":d.guest_key,"channel_url":n},g={},e(a(c),u,function(e){e.error?o.errorFunc(i,e.message):(t(f,e),g=f,o.successFunc(g))},function(e,n){o.errorFunc(e,n)})},L=function(n,r){var o,c,u,g;s("=== Leave Channel ==="),o=t({},R,r),c="channel_leave",u={"app_id":d.app_id,"session_key":d.guest_key,"channel_url":n},g={},e(a(c),u,function(e){e.error?o.errorFunc(i,e.message):(g=e,o.successFunc(g))},function(e,n){o.errorFunc(e,n)})},I=function(n,r){var o,c,u,g;s("=== Member List ==="),o=t({},R,r),c="member_list/",u={"app_id":d.app_id,"channel_url":n},g={},e(a(c),u,function(e){e.error?o.errorFunc(i,e.message):(g=e,o.successFunc(g))},function(e,n){o.errorFunc(e,n)})},D=function(n){var r,o,c,u;s("=== Channel List ==="),n=t({},{"limit":20,"page":1,"query":""},n),r=t({},R,n),o="channel_list/",c={"app_id":d.app_id,"page":r.page,"limit":r.limit,"query":r.query},u={},e(a(o),c,function(e){e.error?r.errorFunc(i,e.message):(u=e,r.successFunc(u))},function(e,n){r.errorFunc(e,n)})},E=function(e){D(e)},J=function(n,r){var o,c,u,g;s("=== Join Messaging Channel ==="),o=t({},R,r),c="messaging_join/",u={"app_id":d.app_id,"session_key":d.guest_key,"channel_url":n},g={},e(a(c),u,function(e){e.error?o.errorFunc(i,e.message):(t(f,e.channel),g=e,o.successFunc(g))},function(e,n){o.errorFunc(e,n)})},w=function(n,r){var o,c,u,g;s("=== Start Messaging ==="),n=n instanceof Array?n:Array(n),o=t({},R,r),c="messaging_start/",u={"app_id":d.app_id,"session_key":d.guest_key,"guest_ids":n},g={},e(a(c),u,function(e){e.error?o.errorFunc(i,e.message):(t(f,e.channel),g=e,o.successFunc(g))},function(e,n){o.errorFunc(e,n)})},C=function(n,r){var o,c,u,g;s("=== Invite Messaging ==="),n=n instanceof Array?n:Array(n),o=t({},R,r),c="messaging_invite/",u={"app_id":d.app_id,"session_key":d.guest_key,"channel_url":f.channel_url,"guest_ids":n},g={},e(a(c),u,function(e){e.error?o.errorFunc(i,e.message):(t(f,e.channel),g=e,o.successFunc(g))},function(e,n){o.errorFunc(e,n)})},G=function(n,r){var o,c,u,g;s("=== End Messaging ==="),o=t({},R,r),c="messaging_end/",u={"app_id":d.app_id,"session_key":d.guest_key,"channel_url":n},g={},e(a(c),u,function(e){e.error?o.errorFunc(i,e.message):(t(f,e),g=e,o.successFunc(g))},function(e,n){o.errorFunc(e,n)})},U=function(n){var r,o,c,u;s("=== Messaging Channel List ==="),n=t({},{"limit":9999,"page":1},n),r=t({},R,n),o="messaging_list/",c={"app_id":d.app_id,"session_key":d.guest_key,"page":r.page,"limit":r.limit},u={},e(a(o),c,function(e){e.error?r.errorFunc(i,e.message):(u=e,r.successFunc(u))},function(e,n){r.errorFunc(e,n)})},j=function(n,r){var o,c,u;s("=== Messaging Channel Info ==="),o=t({},R,r),c="messaging_info/",u={"app_id":d.app_id,"session_key":d.guest_key,"channel_id":n},e(a(c),u,function(e){e.error?o.errorFunc(i,e.message):N.onMessagingChannelUpdateReceived(e)},function(e,n){o.errorFunc(e,n)})},W=function(n,r){var o,c,u,g;s("=== Message Mark As Read ==="),o=t({},R,r),c="mark_as_read/",u={"app_id":d.app_id,"session_key":d.guest_key,"channel_url":n},g={},e(a(c),u,function(e){e.error?o.errorFunc(i,e.message):(g=e,o.successFunc(g))},function(e,n){o.errorFunc(e,n)})},x=function(n){var r,o,c,u,g;s("=== Message Load More ==="),n=t({},{"limit":20},n),r=t({},R,n),o=(new Date).getTime(),c="message_list",u={"app_id":d.app_id,"session_key":d.guest_key,"channel_url":f.channel_url,"message_ts":0==m?o:m,"prev_limit":r.limit,"next_limit":0,"include":!1},g={},e(a(c),u,function(e){e.error?r.errorFunc(i,e.message):(g=e,$.each(g.messages,function(e,n){var s=JSON.parse(n.substring(4));0==m?m=s.ts:m>s.ts&&(m=s.ts)}),r.successFunc(g))},function(e,n){r.errorFunc(e,n)})},A=function(n){var r,o,c;s("=== User List ==="),n=t({},{"token":"","page":1,"limit":30},n),r=t({},R,n),o="user_list/",c={"app_id":d.app_id,"session_key":d.guest_key,"token":r.token,"page":r.page,"limit":r.limit},e(a(o),c,function(e){e.error?r.errorFunc(i,e.message):r.successFunc(e)},function(e,n){r.errorFunc(e,n)})},B=function(e,n){var a,o,u,l,p,f,_;s("=== Upload File ==="),a=t({},R,n),o="upload_file/",u='{"app_id": "'+d.app_id+'"}',l=new FormData,l.append("meta",u),l.append("file",e),p="",f=g+"v"+c.replace(/[^(0-9)]/gi,"")+"/"+o,_=new XMLHttpRequest,_.open("POST",f,a.async),_.onload=function(){var n,s;_.status>=i&&_.status<r?(n=_.responseText,s=JSON.parse(n),s.error?a.errorFunc(i,s.message):(p={"error":!1,"url":s.url},on({"url":s.url,"name":e.name,"type":e.type,"size":e.size,"custom":""}),a.successFunc(p))):a.errorFunc(_.status,_.statusText)},_.send(l)},q=function(){s("=== Typing Start ===");var e=(new Date).getTime();V(p.TPST,{"channel_id":f.id,"time":e}),M=e,S=!0},z=function(){s("=== Typing End ===");var e=(new Date).getTime();V(p.TPEN,{"channel_id":f.id,"time":e}),M=0,S=!1},H=(setInterval(function(){var e=(new Date).getTime();S&&e-M>k&&z()},k),function(e){s("=== Web Socket Connect ==="),Q();var n=t({},R,e);l=new WebSocket(u),l.onopen=function(){var e,s;Z(d.guest_key),e=(new Date).getTime(),en(f.id,e)?(s={},n.successFunc(s)):n.errorFunc(r,"WebSocket is not connected yet."),sn(!0)},l.onmessage=function(e){var n,s,t,i,r;for(_=(new Date).getTime(),n=e.data.split("\n"),s=0;s<n.length;s++)0!=n[s].trim().length&&(t=n[s].substring(0,4),i=n[s].substring(4),(0!==t.trim().length||0!==i.trim().length)&&(t===p.PONG?tn(!1):t==p.MCUP?(r=JSON.parse(i),j(r.channel_id)):T(t,i)))},l.onerror=function(e){s("=== Web Socket onerror ==="),s(e),_isLeavingPage||X(),sn(!1),tn(!1)},l.onclose=function(e){s("=== Web Socket onclose ==="),s(e),_isLeavingPage||X(),sn(!1),tn(!1)}}),Y=function(){s("=== Web Socket Disconnect ==="),K()},X=function(){null==y?(s("=== Start Reconnect ==="),y=setTimeout(function(){H(),y=null,s("=== Reconnect done ===")},3e3)):s("=== Reconnect is in progress. (skip) ===")},K=function(){l&&Q(),f={},m=0,v=null,F=null,y=null,h=0},Q=function(){l&&(l.close(),l.onmessage=function(){},l.onopen=function(){},l.onerror=function(){},l.onclose=function(){},l=null),m=0},V=function(e,n){var s=e+JSON.stringify(n)+"\n";try{if(1!=l.readyState)return!1;l.send(s)}catch(t){return console.log(t),!1}return!0},Z=function(e){V(p.LOGI,{"key":e})},en=function(e,n){return V(p.JOIN,{"channel_id":e,"last_message_ts":n})},nn=function(){var e=(new Date).getTime();h=e,V(p.PING,{"id":e})},sn=function(e){null!=v&&(clearInterval(v),v=null),e?(s("=== Start Pinger ==="),v=setInterval(function(){var e=(new Date).getTime(),n=e-_,t=parseInt(n/1e3);t>0&&t%5==0&&(s(p.PING),nn(),tn(!0))},1e3)):s("=== Stop Pinger ===")},tn=function(e){null!=F&&(clearInterval(F),F=null),e?(s("=== Start Watchdog ==="),F=setInterval(function(){var e=(new Date).getTime(),n=e-_,t=parseInt(n/1e3);20>t||(s("=== Watchdog Barks! ==="),sn(!1),X())},4500)):s("=== Watchdog ===")},rn=function(e,n){n=n||"";var s=V(p.MESG,{"channel_id":f.id,"message":e,"data":"","tid":n});N.onMessageDelivery({"sent":s,"message":e,"data":"","id":n}),s&&setTimeout(function(){z()},100)},an=function(e,n,s){s=s||"";var t=V(p.MESG,{"channel_id":f.id,"message":e,"data":n,"tid":s});N.onMessageDelivery({"sent":t,"message":e,"data":n,"tid":s}),t&&setTimeout(function(){z()},100)},on=function(e){V(p.FILE,{"channel_id":f.id,"name":e.name,"url":e.url,"type":e.type,"size":e.size,"custom":e.custom})},cn=function(e){n=e},un=function(e){var n=e.substring(0,4),s=JSON.parse(e.substring(4));return{"cmd":n,"payload":s}},gn=function(e){return e==p.MESG},ln=function(e){return e==p.FILE},pn=function(e){var n=e.url.split("."),s=n[n.length-1];return"png"==s||"jpeg"==s||"jpg"==s||"gif"==s||"bmp"==s?!0:e.type.indexOf("image")>=0},dn=function(e){return e==O};return{"events":N,"joinChannel":b,"leaveChannel":L,"getMemberList":I,"getChannelSearch":D,"getChannelList":E,"joinMessagingChannel":J,"startMessaging":w,"inviteMessaging":C,"endMessaging":G,"getMessagingChannelList":U,"markAsRead":W,"getMessageLoadMore":x,"getUserList":A,"sendFile":B,"typeStart":q,"connect":H,"disconnect":Y,"message":rn,"messageWithData":an,"sendFileURL":on,"setDebugMessage":cn,"commandSeparate":un,"isMessage":gn,"isFileMessage":ln,"hasImage":pn,"isGroupMessaging":dn,"init":o}}();return a});